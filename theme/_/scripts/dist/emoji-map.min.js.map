{"version":3,"sources":["emoji-map.js"],"names":["sheetURL","sheetCols","sheetRows","sheetElementSize","mapSize","loupeSize","loupeOffset","x","y","zoomFactor","saveSize","document","addEventListener","container","querySelector","console","warn","log","style","createElement","innerHTML","selector","appendChild","map","width","height","backgroundSize","backgroundImage","backgroundRepeat","margin","follower","lastIdx","position","display","borderRadius","canvas","ctx","getContext","img","updateFollower","e","left","clientX","top","clientY","Math","floor","offsetX","offsetY","sheet_x","sheet_y","backgroundPosition","adjustPosition","forceReset","buttons","zx","zy","fullscreen","requestFullscreen","save","drawImage","url","toDataURL","a","href","download","click","src","preventDefault","button","key"],"mappings":"CAAA,WACE,aACA,MACMA,EAAW,yEACXC,EAAY,IACZC,EAAY,IACZC,EAAmB,IAEnBC,EAAU,IACVC,EAAY,IACZC,EAAc,CAACC,EAAE,GAAIC,EAAE,GACvBC,EAAa,EAEbC,EAAW,IAEjBC,SAASC,iBAAiB,mBAAoB,KAC5C,MAAMC,EAAYF,SAASG,cAdZ,cAef,IAAID,EAIF,YADAE,QAAQC,KAAK,6CAFbD,QAAQE,IAAI,iCAMd,MAAMC,EAAQP,SAASQ,cAAc,SACrCD,EAAME,UAAYC,oFAClBV,SAASG,cAAc,QAAQQ,YAAYJ,GAE3C,IAAIK,EAAMZ,SAASQ,cAAc,OACjCI,EAAIL,MAAMM,MAAQpB,EAAU,KAC5BmB,EAAIL,MAAMO,OAASrB,EAAU,KAC7BmB,EAAIL,MAAMQ,eAAiBH,EAAIL,MAAMM,MAAQ,IAAMD,EAAIL,MAAMO,OAC7DF,EAAIL,MAAMS,gBAAkB,OAAS3B,EAAW,IAChDuB,EAAIL,MAAMU,iBAAmB,YAC7BL,EAAIL,MAAMW,OAAS,SACnBhB,EAAUS,YAAYC,GAEtB,MAAMO,EAAWnB,SAASQ,cAAc,OAClCY,EAAU,CAACxB,EAAE,EAAGC,EAAE,GACxBsB,EAASZ,MAAMc,SAAW,QAC1BF,EAASZ,MAAMe,QAAU,OACzBH,EAASZ,MAAMM,MAAQnB,EAAY,KACnCyB,EAASZ,MAAMO,OAASpB,EAAY,KACpCyB,EAASZ,MAAMgB,aAAe7B,EAAU,EAAI,KAC5CyB,EAASZ,MAAMQ,eAAiBrB,EAAUJ,EAAY,MAAQI,EAAUH,EAAY,KACpF4B,EAASZ,MAAMS,gBAAkB,OAAS3B,EAAW,IACrD8B,EAASZ,MAAMU,iBAAmB,YAClCf,EAAUS,YAAYQ,GAEtB,MAAMK,EAASxB,SAASQ,cAAc,UACtCgB,EAAOX,MAAQ,IACfW,EAAOV,OAAS,IAChB,MAAMW,EAAMD,EAAOE,WAAW,MACxBC,EAAM3B,SAASQ,cAAc,OAGnC,SAASoB,EAAeC,GAEtBV,EAASZ,MAAMuB,KAAOD,EAAEE,QAAUpC,EAAYC,EAAI,KAIlDuB,EAASZ,MAAMyB,IAAOH,EAAEI,QAAUtC,EAAYE,EAAI,KAElDuB,EAAQxB,EAAIsC,KAAKC,MAAON,EAAEO,SAAW3C,EAAQH,IAC7C8B,EAAQvB,EAAIqC,KAAKC,MAAON,EAAEQ,SAAW5C,EAAQF,IAE7C,IAAI+C,GAAWlB,EAAQxB,EAAIF,EACvB6C,GAAWnB,EAAQvB,EAAIH,EAC3ByB,EAASZ,MAAMiC,mBAAqBF,EAAU,MAAQC,EAAU,KAGlE,SAASE,EAAeZ,EAAGa,EAAW,GAEpC,GAAiB,GAAbb,EAAEc,SAAiBD,EAMrB9B,EAAIL,MAAMQ,eAAiBtB,EAAU,MAAQA,EAAU,KACvDmB,EAAIL,MAAMiC,mBAAqB,UAPE,CACjC5B,EAAIL,MAAMQ,eAAiBtB,EAAQK,EAAa,MAAQL,EAAQK,EAAa,KAC7E,IAAI8C,EAAKf,EAAEO,SAAWtC,EAAW,GAC7B+C,EAAKhB,EAAEQ,SAAWvC,EAAW,GACjCc,EAAIL,MAAMiC,oBAAsBI,EAAK,OAASC,EAAK,MAmCvD,SAASC,IACP5C,EAAU6C,oBAGZ,SAASC,IACPvB,EAAIwB,UAAUtB,EACZP,EAAQxB,EAAIJ,EAAkB4B,EAAQvB,EAAIL,EAAkBA,EAAkBA,EAC9E,EAAG,EAAGO,EAAUA,GAClB,MAAMmD,EAAM1B,EAAO2B,YACbC,EAAIpD,SAASQ,cAAc,KACjC4C,EAAEC,KAAOH,EACTE,EAAEE,SAAW,UAAYlC,EAAQxB,EAAI,IAAMwB,EAAQvB,EAAI,OACvDuD,EAAEG,QAvEJ5B,EAAI6B,IAAMnE,EA+BVuB,EAAIX,iBAAiB,YAAc4B,IACjCD,EAAeC,GACfY,EAAeZ,KAEjBjB,EAAIX,iBAAiB,aAAe4B,IAClCD,EAAeC,GACfV,EAASZ,MAAMe,QAAU,QACzBmB,EAAeZ,KAEjBjB,EAAIX,iBAAiB,aAAe4B,IAClCV,EAASZ,MAAMe,QAAU,OACzBmB,EAAeZ,EAAG,KAEpBjB,EAAIX,iBAAiB,YAAc4B,IACjCY,EAAeZ,GACfA,EAAE4B,iBACc,GAAZ5B,EAAE6B,QAAaV,MAErBpC,EAAIX,iBAAiB,UAAY4B,IAC/BY,EAAeZ,GACfA,EAAE4B,mBAEJ7C,EAAIX,iBAAiB,cAAgB4B,IACnCA,EAAE4B,mBAGJ7C,EAAIX,iBAAiB,WAAY6C,GAiBjC9C,SAASG,cAAc,QAAQF,iBAAiB,UAAY4B,IAC7C,KAATA,EAAE8B,IAAYb,IACA,KAATjB,EAAE8B,KAAYX,QAlI7B","file":"emoji-map.min.js","sourcesContent":["(function() {\n  'use strict';\n  const selector = '#emoji-map';\n  const sheetURL = '/wp-content/uploads/2018/12/sheet_training_emoji1_100_noborder_q40.jpg';\n  const sheetCols = 100;\n  const sheetRows = 100;\n  const sheetElementSize = 100; // needed for saving\n  \n  const mapSize = 1000;\n  const loupeSize = 100;\n  const loupeOffset = {x:10, y:0};\n  const zoomFactor = 3;\n  // const loupeZoomFactor = 1.5;\n  const saveSize = 300;\n  \n  document.addEventListener(\"DOMContentLoaded\", () => {\n    const container = document.querySelector(selector);\n    if (container) {\n      console.log('emoji-map: init on ' + selector);\n    } else {\n      console.warn('emoji-map: ' + selector + ' not found. quitting');\n      return;\n    }\n    \n    const style = document.createElement('style');\n    style.innerHTML = selector + \":fullscreen {background-color:white; overflow:scroll; padding:150px 0;}\"\n    document.querySelector('body').appendChild(style);\n    \n    let map = document.createElement('div');\n    map.style.width = mapSize + 'px';\n    map.style.height = mapSize + 'px';\n    map.style.backgroundSize = map.style.width + \" \" + map.style.height;\n    map.style.backgroundImage = 'url(' + sheetURL + ')';\n    map.style.backgroundRepeat = 'no-repeat';\n    map.style.margin = \"0 auto\";\n    container.appendChild(map);\n    \n    const follower = document.createElement('div');\n    const lastIdx = {x:0, y:0};\n    follower.style.position = 'fixed';\n    follower.style.display = 'none';\n    follower.style.width = loupeSize + 'px';\n    follower.style.height = loupeSize + 'px';\n    follower.style.borderRadius = loupeSize/2 + 'px';\n    follower.style.backgroundSize = loupeSize*sheetCols + 'px ' + loupeSize*sheetRows + 'px';\n    follower.style.backgroundImage = 'url(' + sheetURL + ')';\n    follower.style.backgroundRepeat = 'no-repeat';\n    container.appendChild(follower);\n    \n    const canvas = document.createElement('canvas');\n    canvas.width = 300;\n    canvas.height = 300;\n    const ctx = canvas.getContext('2d');\n    const img = document.createElement('img');\n    img.src = sheetURL;\n    \n    function updateFollower(e) {\n      // console.log(e.offsetX, e.offsetY);\n      follower.style.left = e.clientX + loupeOffset.x + 'px';\n      // if (e.offsetX > mapSize-(loupeSize+loupeOffset.x)) {\n      //   follower.style.left = e.clientX - (loupeSize + loupeOffset.x) + 'px';\n      // }\n      follower.style.top  = e.clientY + loupeOffset.y + 'px';\n      \n      lastIdx.x = Math.floor( e.offsetX / (mapSize/sheetCols) );\n      lastIdx.y = Math.floor( e.offsetY / (mapSize/sheetRows) );\n      // console.log(idx_x, idx_y);\n      let sheet_x = -lastIdx.x * loupeSize;\n      let sheet_y = -lastIdx.y * loupeSize;\n      follower.style.backgroundPosition = sheet_x + 'px ' + sheet_y + 'px';\n    }\n    \n    function adjustPosition(e, forceReset=0) {\n      // console.log(e.buttons);\n      if (e.buttons == 1 && !forceReset) { // LMB is pressed\n        map.style.backgroundSize = mapSize*zoomFactor + \"px \" + mapSize*zoomFactor + \"px\";\n        let zx = e.offsetX * (zoomFactor-1);\n        let zy = e.offsetY * (zoomFactor-1);\n        map.style.backgroundPosition = -zx + \"px \" + -zy + \"px\";\n      } else {\n        map.style.backgroundSize = mapSize + \"px \" + mapSize + \"px\";\n        map.style.backgroundPosition = \"0 0\";\n      }\n    }\n    \n    map.addEventListener(\"mousemove\", (e) => {\n      updateFollower(e);\n      adjustPosition(e);\n    });\n    map.addEventListener(\"mouseenter\", (e) => {\n      updateFollower(e);\n      follower.style.display = 'block';\n      adjustPosition(e);\n    });\n    map.addEventListener(\"mouseleave\", (e) => {\n      follower.style.display = 'none';\n      adjustPosition(e, 1);\n    });\n    map.addEventListener(\"mousedown\", (e) => {\n      adjustPosition(e);\n      e.preventDefault();\n      if (e.button == 2) save();\n    });\n    map.addEventListener(\"mouseup\", (e) => {\n      adjustPosition(e);\n      e.preventDefault();\n    });\n    map.addEventListener(\"contextmenu\", (e) => {\n      e.preventDefault();\n    });\n    \n    map.addEventListener(\"dblclick\", fullscreen);\n    \n    function fullscreen() {\n      container.requestFullscreen();\n    }\n    \n    function save() {\n      ctx.drawImage(img,\n        lastIdx.x * sheetElementSize, lastIdx.y * sheetElementSize, sheetElementSize, sheetElementSize, \n        0, 0, saveSize, saveSize);\n      const url = canvas.toDataURL();\n      const a = document.createElement('a');\n      a.href = url;\n      a.download = 'aimoji_' + lastIdx.x + '_' + lastIdx.y + '.png';\n      a.click();\n    }\n    \n    document.querySelector('body').addEventListener('keydown', (e) => {\n      if (e.key == 'f') fullscreen();\n      else if (e.key == 's') save(e);\n    });\n  });\n})();\n"]}